<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GolfGag-Gadget</title>
<style>
/* Grundlayout */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden; /* KEIN horizontales Scrollen */
  overflow-y: auto;   /* vertikales Scrollen erlaubt */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: linear-gradient(135deg,#e6f2ff,#f7faff);
  color: #333;
}

/* Container */
.app {
  width: 100%;
  max-width: 1200px;
  margin: 8px auto 40px auto;
  padding: 10px;
  box-sizing: border-box;
}

/* Header */
header { text-align:center; margin-bottom:8px; }
h1 { margin:6px 0; font-size:1.8rem; color:#2b7cff; }

/* Buttons */
button {
  background:#2b7cff; color:#fff; border:none;
  padding:8px 12px; margin:6px; border-radius:8px;
  font-size:1rem; cursor:pointer; transition:background .15s;
}
button:hover { background:#1b5fcc; }

/* Inputs / Selects */
input, select {
  padding:8px; margin:6px 0; font-size:0.95rem;
  border-radius:6px; border:1px solid #ccc;
}

/* Start card */
.start-card {
  display:block;
  background:#fff;
  padding:12px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
  max-width:420px;
  margin:0 auto 12px;
  text-align:center;
}

/* Generators */
.generator-block { display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:8px; }
.generator-card { background:#fff; padding:10px 12px; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.06); min-width:220px; max-width:320px; text-align:center; }
.generator-box { min-height:44px; display:flex; align-items:center; justify-content:center; font-weight:700; }

/* Player / Team layout */
.playersGrid { display:flex; flex-wrap:wrap; gap:12px; align-items:flex-start; justify-content:center; }
.playerCard {
  background:#fff; border-radius:10px; padding:10px; box-shadow:0 3px 8px rgba(0,0,0,0.06);
  min-width:260px; max-width:320px; text-align:left; display:flex; flex-direction:column; gap:8px;
}
.teamCard {
  background: linear-gradient(180deg,#f2f7ff,#ffffff);
  border-radius:12px;
  padding:12px;
  box-shadow:0 3px 8px rgba(0,0,0,0.04);
  width:100%;
  max-width:720px;
  box-sizing:border-box;
}
.teamBox {
  width:100%;
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* Team header row: team name left, team total right */
.teamHeader {
  display:flex; align-items:center; justify-content:space-between; width:100%;
}
.teamName { font-weight:700; font-size:1.05rem; }

/* Team total square (right side of team header in Team-Mode) */
.teamTotalSquare {
  min-width:46px; height:34px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:700; border:1px solid #000; background:#fff; color:#000;
}

/* Holes container */
#holes { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:8px; }

/* Hole card (per-hole controls for non-matchplay modes) */
.holeCard {
  background:#fff; border-radius:12px; padding:10px; width:320px; box-shadow:0 3px 8px rgba(0,0,0,0.06); text-align:center;
}
.holeTitle { font-weight:700; margin-bottom:8px; }

/* Controls row inside hole card */
.holeControls { display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }

/* Placement / Option boxes */
.optionList, .placementTable {
  font-size:0.9rem; margin-top:6px; background:#f9f9f9; padding:6px; border-radius:6px; min-height:40px; width:100%;
}
.placementTable { background:#f0f4f7; }

/* Circles for hole numbers */
.hole-row { display:flex; gap:6px; align-items:center; justify-content:center; flex-wrap:wrap; }
.hole-circle {
  width:34px; height:34px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center;
  font-weight:700; font-size:0.95rem; background:#fff; color:#000; border:2px solid #000;
}
.hole-circle.win { background:#2b7cff; color:#fff; border-color:transparent; }
.hole-circle.lose { background:#d9534f; color:#fff; border-color:transparent; }
.hole-circle.tie { background:#8a8a8a; color:#fff; border-color:transparent; }
.hole-circle.neutral { background:#fff; color:#000; border-color:#000; }

/* Kurzspiel circles (smaller) */
.kurz-wrapper { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
.kurz-cell { display:flex; flex-direction:column; align-items:center; gap:6px; }

/* small score squares */
.score-square { display:inline-flex; width:44px; height:36px; align-items:center; justify-content:center; border-radius:6px; font-weight:700; margin-left:8px; border:1px solid #000; }
.score-neutral { background:#e0e0e0; color:#fff; border-color:rgba(0,0,0,0.08); }
.score-positive { background:#2b7cff; color:#fff; border-color:transparent; }
.score-negative { background:#d9534f; color:#fff; border-color:transparent; }
.score-zero-white { background:#fff; color:#000; border-color:#000; }

.score-small { display:inline-flex; width:36px; height:28px; align-items:center; justify-content:center; border-radius:6px; font-weight:700; }

/* Badges */
.badge { padding:6px 10px; border-radius:16px; font-weight:700; min-width:80px; text-align:center; color:#fff; }
.badge.up { background:#2b7cff; }
.badge.down { background:#d9534f; }
.badge.tied { background:#8a8a8a; }

/* Kurzspiel colors */
.kurz-orange { background:orange; color:#fff; }
.kurz-yellow { background:yellow; color:#000; }
.kurz-blue { background:#2b7cff; color:#fff; }
.kurz-red { background:#d9534f; color:#fff; }
.kurz-purple { background:rebeccapurple; color:#fff; }
.kurz-black { background:#000; color:#fff; }

/* Responsive tweaks */
@media (max-width: 980px) {
  .holeCard { width:46%; }
  .playerCard { min-width:220px; max-width:46%; }
}
@media (max-width: 640px) {
  .holeCard { width:92%; }
  .playerCard { width:92%; max-width:92%; }
  .teamCard { max-width:92%; }
}
</style>
</head>
<body>
<div class="app">
  <header><h1>GolfGag-Gadget</h1></header>

  <div id="startSection" class="start-card">
    <label>Spieleranzahl:
      <select id="playerCount" onchange="updateModeOptions()">
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </label>
    <br>
    <label>Modus:
      <select id="mode"></select>
    </label>
    <br>
    <div id="parSetting" style="display:none; margin-top:8px;">
      <label>PAR für Kurzspiel-Competition:
        <input id="parValue" type="number" min="-10" max="10" value="2" />
      </label>
    </div>
    <br>
    <button onclick="startGame()">Spiel starten</button>
  </div>

  <div id="game" style="display:none; width:100%;">
    <div id="generators" class="generator-block">
      <div class="generator-card" id="clubGeneratorCard">
        <div><button onclick="randomClub()">?? Schläger</button></div>
        <div id="clubResultBox" class="generator-box"></div>
      </div>
      <div class="generator-card" id="formGeneratorCard">
        <div><button onclick="randomForm()">?? Spielform</button></div>
        <div id="formResultBox" class="generator-box"></div>
      </div>
    </div>

    <div id="playersWrapper" style="width:100%;">
      <div id="playersSection" class="playersGrid"></div>
    </div>

    <div id="holesSection" style="width:100%; margin-top:8px;">
      <div id="holes"></div>
    </div>
  </div>
</div>

<script>
/* --- Data --- */
let clubs=["Driver","Holz 3","Holz 5","Hybrid","Eisen 4","Eisen 5","Eisen 6","Eisen 7","Eisen 8","Eisen 9","Pitching Wedge","Gap Wedge","Sand Wedge","Lob Wedge","Putter"];
let forms=["Zufallsschläger (Einer für die Bahn)","Zufallsschläger (für Alle)","Zufallsschläger (Luck of the draw)","Nur Eisen 7","Nur Pitching Wedge","Nur Hölzer","Von Rot","Von Gelb","Nimm 2 -Best Ball","Nimm 2 -Worst Ball","Scramble Best Ball","Scramble Worst Ball","Nur zwei Zufallsschläger","Pflicht-Fairway-/Grüntreffer","Leder Wedge","Leder Wedge Mitspieler (Grün rettet)","Mitspieler wählen Schläger"];
let options=[
  {name:"Holz getroffen",value:-1},{name:"Penalty Area",value:-1},{name:"Out of bounds",value:-1},{name:"3–Putt",value:-1},{name:"1-Putt",value:+1},{name:"Chip-In",value:+1},{name:"Birdie",value:+1},{name:"Nearest to the Pin",value:+1},{name:"Fairway verfehlt",value:-1},{name:"Green in Regulation",value:+1},{name:"PAR gerettet",value:+1},{name:"Bunker",value:-1},{name:"Sandy PAR",value:+1},{name:"Socket",value:-1},{name:"Lady",value:-1},{name:"2 Chips",value:-1},{name:"Über‘s Grün getoppt",value:-1},{name:"Doppel-PAR und mehr",value:-1},{name:"Goldene Ananas",value:-1},{name:"Luftschlag",value:-1},{name:"Leider kurz",value:-1},{name:"Schneckenficker",value:-1},{name:"Großer Schwung, kleines Ergebnis",value:-1},{name:"Luftalarm",value:-1},
  {name:"Texas Wedge", value:+1}
];

let players=[];
let optionOwner={};
let placements={};
let kurzScores = {}; // {playerIndex: {hole:score}}
/* For team-mode team totals */
let teamTotals = {A:0, B:0};

/* MODE SELECT */
function updateModeOptions(){
  const count=parseInt(document.getElementById("playerCount").value);
  const modeSel=document.getElementById("mode");
  modeSel.innerHTML="";
  let opt=document.createElement("option");
  opt.value="einzel"; opt.textContent="Einzel"; modeSel.appendChild(opt);
  let opt2=document.createElement("option");
  opt2.value="kurz"; opt2.textContent="Kurzspiel-Competition"; modeSel.appendChild(opt2);
  if(count==4){let optTeam=document.createElement("option"); optTeam.value="team"; optTeam.textContent="Team"; modeSel.appendChild(optTeam);}
  if(count==2||count==4){let optMp=document.createElement("option"); optMp.value="matchplay"; optMp.textContent="Matchplay"; modeSel.appendChild(optMp);}
  document.getElementById("mode").onchange = function(){
    document.getElementById("parSetting").style.display = (document.getElementById("mode").value === "kurz") ? "block" : "none";
  };
  document.getElementById("mode").dispatchEvent(new Event('change'));
}

/* START / RESET */
function startGame(){
  const count=parseInt(document.getElementById("playerCount").value);
  const mode=document.getElementById("mode").value;
  players=[]; optionOwner={}; placements={}; kurzScores={}; teamTotals={A:0,B:0};
  for(let i=0;i<count;i++){players.push({name:"",bonus:0,selectedOptions:[]}); kurzScores[i] = {}; }
  document.getElementById("startSection").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("generators").style.display = (mode === "matchplay" || mode === "kurz") ? "none" : "flex";
  renderPlayers();
  renderHoles(count,mode);
}

function resetGame(){
  document.getElementById("game").style.display="none";
  document.getElementById("startSection").style.display="block";
  document.getElementById("clubResultBox").textContent="";
  document.getElementById("formResultBox").textContent="";
  optionOwner={}; placements={}; kurzScores={};
}

function randomClub(){document.getElementById("clubResultBox").textContent=clubs[Math.floor(Math.random()*clubs.length)];}
function randomForm(){
  const f=forms[Math.floor(Math.random()*forms.length)];
  const m=f.match(/^(.*?)\s*\((.*)\)\s*$/);
  if(m){
    document.getElementById("formResultBox").textContent = m[1] + "\n" + m[2];
  } else {
    document.getElementById("formResultBox").textContent = f;
  }
}

/* RENDER PLAYERS (inkl. Matchplay/Team/Kurzspiel) */
function renderPlayers(){
  const container=document.getElementById("playersSection");
  container.innerHTML="";
  const mode=document.getElementById("mode").value;
  const count=players.length;

  /* TEAM-MODE (4 Spieler) -> stacked team boxes A über B */
  if(mode==="team" && count===4){
    // Team A box
    const teamA = document.createElement('div'); teamA.className='teamCard';
    teamA.innerHTML = `<div class="teamHeader"><div class="teamName">Team A</div><div id="teamA-total" class="teamTotalSquare">0</div></div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <div class="playerCard" style="margin:0;">
          <div>Spieler 1:<br><input type="text" oninput="players[0].name=this.value; updateUI();" /></div>
          <div class="optionList" id="opt0"><div id="optListInner0"></div><div id="bonus-square-0" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement0"></div>
        </div>
        <div class="playerCard" style="margin:0;">
          <div>Spieler 2:<br><input type="text" oninput="players[1].name=this.value; updateUI();" /></div>
          <div class="optionList" id="opt1"><div id="optListInner1"></div><div id="bonus-square-1" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement1"></div>
        </div>
      </div>
      <div style="margin-top:8px;">
        <div class="hole-row" id="teamA-holes-1"></div>
        <div class="hole-row" id="teamA-holes-2"></div>
      </div>`;

    // Team B box
    const teamB = document.createElement('div'); teamB.className='teamCard';
    teamB.innerHTML = `<div class="teamHeader"><div class="teamName">Team B</div><div id="teamB-total" class="teamTotalSquare">0</div></div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <div class="playerCard" style="margin:0;">
          <div>Spieler 3:<br><input type="text" oninput="players[2].name=this.value; updateUI();" /></div>
          <div class="optionList" id="opt2"><div id="optListInner2"></div><div id="bonus-square-2" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement2"></div>
        </div>
        <div class="playerCard" style="margin:0;">
          <div>Spieler 4:<br><input type="text" oninput="players[3].name=this.value; updateUI();" /></div>
          <div class="optionList" id="opt3"><div id="optListInner3"></div><div id="bonus-square-3" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement3"></div>
        </div>
      </div>
      <div style="margin-top:8px;">
        <div class="hole-row" id="teamB-holes-1"></div>
        <div class="hole-row" id="teamB-holes-2"></div>
      </div>`;

    container.appendChild(teamA);
    container.appendChild(teamB);

    // build hole circles for team boxes
    for(let h=1; h<=9; h++){
      const a = document.createElement('div'); a.className='hole-circle neutral'; a.id = `team1-hole-${h}`; a.textContent = h; document.getElementById('teamA-holes-1').appendChild(a);
      const b = document.createElement('div'); b.className='hole-circle neutral'; b.id = `team2-hole-${h}`; b.textContent = h; document.getElementById('teamB-holes-1').appendChild(b);
    }
    for(let h=10; h<=18; h++){
      const a = document.createElement('div'); a.className='hole-circle neutral'; a.id = `team1-hole-${h}`; a.textContent = h; document.getElementById('teamA-holes-2').appendChild(a);
      const b = document.createElement('div'); b.className='hole-circle neutral'; b.id = `team2-hole-${h}`; b.textContent = h; document.getElementById('teamB-holes-2').appendChild(b);
    }

    updateUI();
    return;
  }

  /* MATCHPLAY (4 Spieler) - original matchplay layout: Team A above Team B (like earlier) */
  if(mode==="matchplay" && players.length===4){
    let wrapper=document.createElement("div");
    wrapper.style.width="100%";
    wrapper.style.display="flex";
    wrapper.style.flexDirection="column";
    wrapper.style.gap="12px";

    // Team A block
    let t1=document.createElement("div"); t1.className='teamCard';
    t1.innerHTML = `<div class="teamHeader"><strong>Team A</strong><div style="display:flex; gap:10px; align-items:center;"><div id="status-team1" class="badge tied">TIED</div><div id="teamA-total" class="score-square score-zero-white">0</div></div></div>
      <div style="display:flex; gap:8px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;">
        <div style="flex:1; min-width:200px;">
          Spieler 1:<br><input type="text" oninput="players[0].name=this.value;updateUI();">
          <div class="optionList" id="opt0" style="display:flex; align-items:center;"><div id="optListInner0" style="flex:1;"></div><div id="bonus-square-0" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement0"></div>
        </div>
        <div style="flex:1; min-width:200px;">
          Spieler 2:<br><input type="text" oninput="players[1].name=this.value;updateUI();">
          <div class="optionList" id="opt1" style="display:flex; align-items:center;"><div id="optListInner1" style="flex:1;"></div><div id="bonus-square-1" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement1"></div>
        </div>
      </div>
      <div style="margin-top:8px;"><div class="hole-row" id="teamA-holes-1"></div><div class="hole-row" id="teamA-holes-2"></div></div>`;

    // Team B block
    let t2=document.createElement("div"); t2.className='teamCard';
    t2.innerHTML = `<div class="teamHeader"><strong>Team B</strong><div style="display:flex; gap:10px; align-items:center;"><div id="status-team2" class="badge tied">TIED</div><div id="teamB-total" class="score-square score-zero-white">0</div></div></div>
      <div style="display:flex; gap:8px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;">
        <div style="flex:1; min-width:200px;">
          Spieler 3:<br><input type="text" oninput="players[2].name=this.value;updateUI();">
          <div class="optionList" id="opt2" style="display:flex; align-items:center;"><div id="optListInner2" style="flex:1;"></div><div id="bonus-square-2" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement2"></div>
        </div>
        <div style="flex:1; min-width:200px;">
          Spieler 4:<br><input type="text" oninput="players[3].name=this.value;updateUI();">
          <div class="optionList" id="opt3" style="display:flex; align-items:center;"><div id="optListInner3" style="flex:1;"></div><div id="bonus-square-3" class="score-small score-zero-white">0</div></div>
          <div class="placementTable" id="placement3"></div>
        </div>
      </div>
      <div style="margin-top:8px;"><div class="hole-row" id="teamB-holes-1"></div><div class="hole-row" id="teamB-holes-2"></div></div>`;

    wrapper.appendChild(t1); wrapper.appendChild(t2);
    container.appendChild(wrapper);

    // build hole circles for teams
    for(let h=1; h<=9; h++){
      const a = document.createElement('div'); a.className='hole-circle neutral'; a.id = `team1-hole-${h}`; a.textContent = h; document.getElementById('teamA-holes-1').appendChild(a);
      const b = document.createElement('div'); b.className='hole-circle neutral'; b.id = `team2-hole-${h}`; b.textContent = h; document.getElementById('teamB-holes-1').appendChild(b);
    }
    for(let h=10; h<=18; h++){
      const a = document.createElement('div'); a.className='hole-circle neutral'; a.id = `team1-hole-${h}`; a.textContent = h; document.getElementById('teamA-holes-2').appendChild(a);
      const b = document.createElement('div'); b.className='hole-circle neutral'; b.id = `team2-hole-${h}`; b.textContent = h; document.getElementById('teamB-holes-2').appendChild(b);
    }

    updateUI();
    return;
  }

  /* MATCHPLAY (2 Spieler) - each player's placementTable contains the hole circles (instead of textual box) */
  if(mode==="matchplay" && players.length===2){
    let row=document.createElement("div"); row.style.display="flex"; row.style.gap="12px"; row.style.justifyContent="center"; row.style.flexWrap="wrap";

    for(let i=0;i<2;i++){
      let div=document.createElement("div"); div.className="playerCard";
      div.innerHTML = `<div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
        <div><strong>Spieler ${i+1}</strong><br><input type="text" oninput="players[${i}].name=this.value;updateUI();"></div>
        <div style="display:flex; flex-direction:column; align-items:center; gap:6px;">
          <div id="status${i}" class="badge tied" style="min-width:90px; justify-content:center; text-align:center;">TIED</div>
          <div id="score${i}" class="score-square score-zero-white">0</div>
        </div>
      </div>
      <div class="placementTable" id="placement${i}" style="margin-top:8px; display:flex; flex-direction:column; gap:6px;">
        <div style="font-weight:700; text-align:center;">Bahnen</div>
        <div class="hole-row" id="p${i}-holes-1" style="justify-content:center;"></div>
        <div class="hole-row" id="p${i}-holes-2" style="justify-content:center;"></div>
      </div>`;

      row.appendChild(div);
    }
    container.appendChild(row);

    // create hole circles for each player's placementTable (they will change color per-placement)
    for(let i=0;i<2;i++){
      for(let h=1; h<=9; h++){
        const el = document.createElement('div'); el.className='hole-circle neutral'; el.id=`p${i}-hole-${h}`; el.textContent=h;
        document.getElementById(`p${i}-holes-1`).appendChild(el);
      }
      for(let h=10; h<=18; h++){
        const el = document.createElement('div'); el.className='hole-circle neutral'; el.id=`p${i}-hole-${h}`; el.textContent=h;
        document.getElementById(`p${i}-holes-2`).appendChild(el);
      }
    }
    updateUI();
    return;
  }

  /* Kurzspiel mode or Einzel/normal strokeplay rendering */
  let row=document.createElement("div"); row.className="playersGrid";
  players.forEach((p,i)=>{
    let div=document.createElement("div"); div.className="playerCard";
    div.innerHTML=`<div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
      <div>Spieler ${i+1}:<br><input type="text" oninput="players[${i}].name=this.value;updateUI();"></div>
      <div id="score${i}" class="score-square score-zero-white">0</div>
    </div>
    <div style="margin-top:6px;">
      <select onchange="addOption(${i},this.value)"><option value="">Option wählen…</option>${options.map(o=>`<option value="${o.name}">${o.name} (${o.value>0?'+':''}${o.value})</option>`).join('')}</select>
    </div>
    <div class="optionList" id="opt${i}" style="display:flex; align-items:center; width:100%;"><div id="optListInner${i}" style="flex:1;"></div><div id="bonus-square-${i}" class="score-small score-zero-white">0</div></div>
    <div class="placementTable" id="placement${i}" style="margin-top:6px;"></div>`;
    row.appendChild(div);
  });
  container.appendChild(row);
  updateUI();
}

/* ADD OPTION */
function addOption(playerIndex,optionName){
  if(!optionName)return;
  const opt=options.find(o=>o.name===optionName);
  if(!opt)return;
  if(optionOwner[optionName]!==undefined){
    let prevIndex=optionOwner[optionName];
    let prev=players[prevIndex];
    prev.bonus-=opt.value;
    prev.selectedOptions=prev.selectedOptions.filter(o=>o.name!==optionName);
  }
  let p=players[playerIndex];
  if(!p.selectedOptions.find(o=>o.name===opt.name)){
    p.selectedOptions.push(opt); p.bonus+=opt.value; optionOwner[optionName]=playerIndex;
  }
  updateUI();
}

/* RENDER HOLES (selects etc.) */
function renderHoles(count,mode){
  const holesDiv=document.getElementById("holes");
  holesDiv.innerHTML="";
  for(let h=1;h<=18;h++){
    let wrapper=document.createElement("div");
    wrapper.className="holeCard";

    let headline=document.createElement("div");
    headline.className="holeTitle";
    headline.textContent=`Bahn ${h}`;
    wrapper.appendChild(headline);

    let controls=document.createElement("div");
    controls.className="holeControls";

    if(mode==="matchplay" && count===4){
      // Individual selects 1..4 per player to allow team auto-eval
      let html='';
      for(let i=0;i<4;i++){
        html+=`<div style="text-align:center;"><label>${i+1}:<br><select id="sel-${h}-${i}" onchange="setPlacement(${h},${i},this.value)"><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="T">T</option></select></label></div>`;
      }
      controls.innerHTML = html;
    } else if(mode==="matchplay" && count===2){
      // For 2-player matchplay keep winner/loser/geteilt selects
      controls.innerHTML=`
        <div>
          Spieler 1<br>
          <select id="sel-${h}-0" onchange="setPlacementMatchplay(${h},0,this.value)"><option value="">-</option><option value="Gewonnen">Gewonnen</option><option value="Verloren">Verloren</option><option value="Geteilt">Geteilt</option></select>
        </div>
        <div>
          Spieler 2<br>
          <select id="sel-${h}-1" onchange="setPlacementMatchplay(${h},1,this.value)"><option value="">-</option><option value="Gewonnen">Gewonnen</option><option value="Verloren">Verloren</option><option value="Geteilt">Geteilt</option></select>
        </div>`;
    } else if(mode==="kurz"){
      controls.innerHTML = `<div style="font-size:0.9rem; color:#666;">Kurzspiel-Competition: Eingabe in Scorecards</div>`;
    } else {
      // normal strokeplay / Einzel / Team mode (non-matchplay)
      let html='';
      for(let i=0;i<count;i++){
        if(count==2){
          html+=`<label class="small-select-label">${i+1}:<select id="sel-${h}-${i}" onchange="setPlacement(${h},${i},this.value)"><option value="">-</option><option value="1">1</option><option value="2">2</option><option value="T">T</option></select></label>`;
        }else{
          html+=`<label class="small-select-label">${i+1}:<select id="sel-${h}-${i}" onchange="setPlacement(${h},${i},this.value)"><option value="">-</option><option value="1">1</option><option value="2">2</option>${count>=3?'<option value="3">3</option>':''}${count==4?'<option value="4">4</option>':''}<option value="T">T</option></select></label>`;
        }
      }
      controls.innerHTML=html;
    }

    wrapper.appendChild(controls);
    holesDiv.appendChild(wrapper);
  }
  document.getElementById("holesSection").style.display="block";

  if(document.getElementById("mode").value === "kurz"){
    renderKurzspielScorecards();
    document.getElementById("holesSection").style.display = "none";
  }
}

/* SET PLACEMENT for strokeplay */
function setPlacement(hole,playerIndex,place){
  const count=players.length;
  if(!place){
    delete placements[`${hole}-${playerIndex}`];
    if(count==2){
      delete placements[`${hole}-${1-playerIndex}`];
      const otherSel = document.getElementById(`sel-${hole}-${1-playerIndex}`); if(otherSel) otherSel.value = "";
      // update circles if matchplay etc
    }
    if(document.getElementById("mode").value==="matchplay" && players.length===4) computeTeamScoringFromIndividuals();
    updateUI(); return;
  }

  if(place==="T"){
    for(let i=0;i<count;i++){
      placements[`${hole}-${i}`]={points:0,label:"T"};
      const sel=document.getElementById(`sel-${hole}-${i}`); if(sel) sel.value="T";
    }
    if(document.getElementById("mode").value==="matchplay" && players.length===4) computeTeamScoringFromIndividuals();
    updateUI(); return;
  }

  let num=parseInt(place);if(isNaN(num))return;
  let points=0;
  if(count==4){if(num==1)points=+2;if(num==2)points=+1;if(num==3)points=-1;if(num==4)points=-2;}
  else if(count==3){if(num==1)points=+1;if(num==2)points=0;if(num==3)points=-1;}
  else if(count==2){if(num==1)points=+1;if(num==2)points=-1;}

  placements[`${hole}-${playerIndex}`]={points:points,label:num};

  // Automatic complementary logic for 2-player strokeplay: set the other player's placement automatically
  if(count==2){
    const other = 1 - playerIndex;
    const otherVal = (num === 1 ? 2 : (num === 2 ? 1 : null));
    if(otherVal !== null){
      let otherPoints = (otherVal===1? +1 : -1);
      placements[`${hole}-${other}`] = {points: otherPoints, label: otherVal};
      const otherSel = document.getElementById(`sel-${hole}-${other}`);
      if(otherSel) otherSel.value = otherVal;
    }
  }

  if(document.getElementById("mode").value==="matchplay" && players.length===4) computeTeamScoringFromIndividuals();
  updateUI();
}

/* SET PLACEMENT for 2-player matchplay (selects) */
function setPlacementMatchplay(hole,playerIndex,value){
  if(value===""){ delete placements[`${hole}-0`]; delete placements[`${hole}-1`]; updateSelectReflect(hole); updateUI(); return; }
  if(value==="Gewonnen"){ placements[`${hole}-0`]=(playerIndex===0)?{result:"Gewonnen"}:{result:"Verloren"};
    placements[`${hole}-1`]=(playerIndex===0)?{result:"Verloren"}:{result:"Gewonnen"}; }
  else if(value==="Verloren"){ placements[`${hole}-0`]=(playerIndex===0)?{result:"Verloren"}:{result:"Gewonnen"};
    placements[`${hole}-1`]=(playerIndex===0)?{result:"Gewonnen"}:{result:"Verloren"}; }
  else if(value==="Geteilt"){ placements[`${hole}-0`]={result:"Geteilt"}; placements[`${hole}-1`]={result:"Geteilt"}; }
  updateSelectReflect(hole);
  updateUI();
}

/* SET PLACEMENT for Team selects (kept as optional) */
function setPlacementMatchplayTeam(hole,team,value){
  if(value===""){ delete placements[`${hole}-team1`]; delete placements[`${hole}-team2`]; updateSelectReflectTeam(hole); updateUI(); return;}
  if(value==="Gewonnen"){ placements[`${hole}-team1`]=(team===1)?{result:"Gewonnen"}:{result:"Verloren"};
    placements[`${hole}-team2`]=(team===1)?{result:"Verloren"}:{result:"Gewonnen"}; }
  else if(value==="Verloren"){ placements[`${hole}-team1`]=(team===1)?{result:"Verloren"}:{result:"Gewonnen"};
    placements[`${hole}-team2`]=(team===1)?{result:"Gewonnen"}:{result:"Verloren"}; }
  else if(value==="Geteilt"){ placements[`${hole}-team1`]={result:"Geteilt"}; placements[`${hole}-team2`]={result:"Geteilt"}; }
  updateSelectReflectTeam(hole);
  computeTeamScoringFromIndividuals();
  updateUI();
}

function updateSelectReflect(hole){
  if(document.getElementById(`sel-${hole}-0`) && placements[`${hole}-0`]) document.getElementById(`sel-${hole}-0`).value = placements[`${hole}-0`].result || placements[`${hole}-0`].label || "";
  if(document.getElementById(`sel-${hole}-1`) && placements[`${hole}-1`]) document.getElementById(`sel-${hole}-1`).value = placements[`${hole}-1`].result || placements[`${hole}-1`].label || "";
}
function updateSelectReflectTeam(hole){
  if(document.getElementById(`sel-${hole}-team-1`) && placements[`${hole}-team1`]) document.getElementById(`sel-${hole}-team-1`).value = placements[`${hole}-team1`].result;
  if(document.getElementById(`sel-${hole}-team-2`) && placements[`${hole}-team2`]) document.getElementById(`sel-${hole}-team-2`).value = placements[`${hole}-team2`].result;
}

/* AUTOMATIC TEAM AUSWERTUNG basierend auf individuellen Platzierungen (1..4 oder 'T')
   Team A = Spieler 0 & 1, Team B = Spieler 2 & 3.
   Bestes (kleinste) numeric label innerhalb Team entscheidet. If both teams have a player with numeric 1 -> tie.
   Assigned team result stored in placements[`${h}-team1`] & `${h}-team2`.
*/
function computeTeamScoringFromIndividuals(){
  if(players.length < 4) return;
  for(let h=1; h<=18; h++){
    let bestA = null; let bestB = null;
    for(let pi=0; pi<4; pi++){
      const ent = placements[`${h}-${pi}`];
      if(!ent) continue;
      const lab = ent.label;
      if(lab === "T"){
        if(pi<=1){ if(bestA===null) bestA='T'; }
        else { if(bestB===null) bestB='T'; }
      } else if(typeof lab === 'number'){
        if(pi<=1){
          if(bestA===null || bestA==='T' || lab < bestA) bestA = lab;
        } else {
          if(bestB===null || bestB==='T' || lab < bestB) bestB = lab;
        }
      }
    }

    if(bestA === null && bestB === null){
      delete placements[`${h}-team1`];
      delete placements[`${h}-team2`];
      continue;
    }
    let resA=null, resB=null;
    // If both have numeric 1 => tie
    if(typeof bestA === 'number' && typeof bestB === 'number'){
      if(bestA < bestB){ resA='Gewonnen'; resB='Verloren'; }
      else if(bestA > bestB){ resA='Verloren'; resB='Gewonnen'; }
      else { resA='Geteilt'; resB='Geteilt'; }
    } else if(bestA === 'T' && bestB === 'T'){ resA='Geteilt'; resB='Geteilt'; }
    else if(bestA === 'T' && typeof bestB === 'number'){ resA='Verloren'; resB='Gewonnen'; }
    else if(bestB === 'T' && typeof bestA === 'number'){ resA='Gewonnen'; resB='Verloren'; }
    else if(typeof bestA === 'number' && bestB === null){ resA='Gewonnen'; resB='Verloren'; }
    else if(typeof bestB === 'number' && bestA === null){ resA='Verloren'; resB='Gewonnen'; }
    else { resA='Geteilt'; resB='Geteilt'; }

    placements[`${h}-team1`] = { result: resA };
    placements[`${h}-team2`] = { result: resB };
  }

  // Update team totals for Team-Mode (counts +1 for Gewonnen, -1 for Verloren, 0 for Geteilt)
  let totalA=0, totalB=0;
  for(let h=1; h<=18; h++){
    const a = placements[`${h}-team1`];
    const b = placements[`${h}-team2`];
    if(a && a.result === 'Gewonnen') totalA++;
    else if(a && a.result === 'Verloren') totalA--;
    if(b && b.result === 'Gewonnen') totalB++;
    else if(b && b.result === 'Verloren') totalB--;
  }
  teamTotals.A = totalA; teamTotals.B = totalB;

  // Reflect team totals in Team-Mode UI squares if present
  const tA = document.getElementById("teamA-total"), tB = document.getElementById("teamB-total");
  if(tA) {
    tA.textContent = totalA;
    applyTeamTotalStyles(tA, totalA);
  }
  if(tB) {
    tB.textContent = totalB;
    applyTeamTotalStyles(tB, totalB);
  }

  // Update hole circle visuals for teams
  for(let h=1; h<=18; h++){
    updateTeamCircles(h);
  }
}

/* Team total square color rules */
function applyTeamTotalStyles(el, val){
  if(val > 0){
    el.style.background = '#2b7cff'; el.style.color = '#fff'; el.style.border = 'none';
  } else if(val < 0){
    el.style.background = '#d9534f'; el.style.color = '#fff'; el.style.border = 'none';
  } else {
    el.style.background = '#8a8a8a'; el.style.color = '#fff'; el.style.border = 'none';
  }
}

/* Update team hole circles (set class based on placements[`${h}-team1`]) */
function updateTeamCircles(hole){
  const a = placements[`${hole}-team1`];
  const b = placements[`${hole}-team2`];
  const elA = document.getElementById(`team1-hole-${hole}`);
  const elB = document.getElementById(`team2-hole-${hole}`);
  if(elA){
    if(a && a.result === "Gewonnen") { elA.className='hole-circle win'; elA.style.color='#fff'; }
    else if(a && a.result === "Verloren") { elA.className='hole-circle lose'; elA.style.color='#fff'; }
    else if(a && a.result === "Geteilt") { elA.className='hole-circle tie'; elA.style.color='#fff'; }
    else { elA.className='hole-circle neutral'; elA.style.color='#000'; }
  }
  if(elB){
    if(b && b.result === "Gewonnen") { elB.className='hole-circle win'; elB.style.color='#fff'; }
    else if(b && b.result === "Verloren") { elB.className='hole-circle lose'; elB.style.color='#fff'; }
    else if(b && b.result === "Geteilt") { elB.className='hole-circle tie'; elB.style.color='#fff'; }
    else { elB.className='hole-circle neutral'; elB.style.color='#000'; }
  }
}

/* UPDATE UI general (non-matchplay) */
function updateUI(){
  const mode=document.getElementById("mode").value;
  if(mode==="matchplay"){ updateMatchplayUI(); return; }
  if(mode==="kurz"){ updateKurzspielTotals(); return; }

  // Update per-player totals, bonuses, placement textboxes
  players.forEach((p,i)=>{
    // sum placements
    let placementSum=0;
    for(let h=1;h<=18;h++){
      let key=`${h}-${i}`;
      if(placements[key]!==undefined && placements[key].points!==undefined){
        placementSum+=placements[key].points;
      }
    }
    const total = p.bonus + placementSum;
    const scoreEl = document.getElementById("score"+i);
    if(scoreEl){
      scoreEl.textContent = total;
      if(total>0) scoreEl.className = "score-square score-positive";
      else if(total<0) scoreEl.className = "score-square score-negative";
      else scoreEl.className = "score-square score-neutral";
    }
    const optInner = document.getElementById(`optListInner${i}`);
    if(optInner) optInner.innerHTML = p.selectedOptions.map(o=>`${o.name} (${o.value>0?'+':''}${o.value})`).join('<br>');
    const bonusSquare = document.getElementById(`bonus-square-${i}`);
    if(bonusSquare){
      const b = p.bonus || 0;
      bonusSquare.textContent = b;
      if(b>0) bonusSquare.className = "score-small score-positive";
      else if(b<0) bonusSquare.className = "score-small score-negative";
      else bonusSquare.className = "score-small score-zero-white";
    }
    const placementDiv = document.getElementById("placement"+i);
    if(placementDiv){
      let placementHtml='';
      for(let h=1;h<=18;h++){
        let key=`${h}-${i}`;
        if(placements[key]!==undefined && placements[key].points!==undefined){
          placementHtml+=`Bahn ${h}: ${placements[key].points} Punkte<br>`;
        }
      }
      placementDiv.innerHTML = placementHtml;
    }
  });
}

/* MATCHPLAY UI update for 2 and 4 players */
function updateMatchplayUI(){
  const count=players.length;

  if(count===2){
    // compute net up
    let up=0; let played=0;
    for(let h=1;h<=18;h++){
      if(placements[`${h}-0`] && placements[`${h}-0`].result){
        played++;
        if(placements[`${h}-0`].result==="Gewonnen") up++;
        else if(placements[`${h}-0`].result==="Verloren") up--;
      }
    }
    let remaining = 18-played;
    let status0="", status1="", class0="", class1="";
    if(up===0){ status0=status1="TIED"; class0=class1="badge tied"; }
    else if(up>0){
      if(up>remaining){ status0=`${up} & ${remaining}`; status1="DOWN"; class0="badge up"; class1="badge down"; }
      else { status0=`${up} UP`; status1=`${Math.abs(up)} DOWN`; class0="badge up"; class1="badge down"; }
    } else {
      let abs=Math.abs(up);
      if(abs>remaining){ status1=`${abs} & ${remaining}`; status0="DOWN"; class1="badge up"; class0="badge down"; }
      else { status1=`${abs} UP`; status0=`${abs} DOWN`; class1="badge up"; class0="badge down"; }
    }
    if(document.getElementById("status0")){ document.getElementById("status0").textContent=status0; document.getElementById("status0").className=class0; }
    if(document.getElementById("status1")){ document.getElementById("status1").textContent=status1; document.getElementById("status1").className=class1; }

    // update hole circles & placements for each player (circles shown inside the gray placementTable)
    for(let h=1;h<=18;h++){
      const e0 = placements[`${h}-0`];
      const e1 = placements[`${h}-1`];
      const el0 = document.getElementById(`p0-hole-${h}`);
      const el1 = document.getElementById(`p1-hole-${h}`);
      if(!el0 || !el1) continue;
      if(e0 && e0.result){
        if(e0.result==="Gewonnen"){ el0.className='hole-circle win'; el1.className='hole-circle lose'; el0.style.color='#fff'; el1.style.color='#fff'; }
        else if(e0.result==="Verloren"){ el0.className='hole-circle lose'; el1.className='hole-circle win'; el0.style.color='#fff'; el1.style.color='#fff'; }
        else { el0.className='hole-circle tie'; el1.className='hole-circle tie'; el0.style.color='#fff'; el1.style.color='#fff'; }
      } else { el0.className='hole-circle neutral'; el1.className='hole-circle neutral'; el0.style.color='#000'; el1.style.color='#000'; }
    }

    // totals display net (centered)
    const s0 = document.getElementById("score0"), s1 = document.getElementById("score1");
    if(s0 && s1){
      s0.textContent = up; s1.textContent = -up;
      if(up>0){ s0.className="score-square score-positive"; s1.className="score-square score-negative"; }
      else if(up<0){ s0.className="score-square score-negative"; s1.className="score-square score-positive"; }
      else { s0.className="score-square score-neutral"; s1.className="score-square score-neutral"; }
    }

    // Note: textual placement table unchanged but user requested that textual "Bahn Ergebnis" is not required — we've replaced that with circles in placementTable already.

    return;
  }

  if(count===4){
    // compute teams from individuals
    computeTeamScoringFromIndividuals();

    // compute up value from team1 results (for Matchplay 4p)
    let up=0; let played=0;
    for(let h=1;h<=18;h++){
      if(placements[`${h}-team1`] && placements[`${h}-team1`].result){
        played++;
        if(placements[`${h}-team1`].result==="Gewonnen") up++;
        else if(placements[`${h}-team1`].result==="Verloren") up--;
      }
    }
    let remaining=18-played;
    let s1="", s2="", c1="", c2="";
    if(up===0){ s1=s2="TIED"; c1=c2="badge tied"; }
    else if(up>0){
      if(up>remaining){ s1=`${up} & ${remaining}`; s2="DOWN"; c1="badge up"; c2="badge down"; }
      else { s1=`${up} UP`; s2=`${Math.abs(up)} DOWN`; c1="badge up"; c2="badge down"; }
    } else {
      let abs=Math.abs(up);
      if(abs>remaining){ s2=`${abs} & ${remaining}`; s1="DOWN"; c2="badge up"; c1="badge down"; }
      else { s2=`${abs} UP`; s1=`${abs} DOWN`; c2="badge up"; c1="badge down"; }
    }
    if(document.getElementById("status-team1")){ document.getElementById("status-team1").textContent = s1; document.getElementById("status-team1").className = c1; }
    if(document.getElementById("status-team2")){ document.getElementById("status-team2").textContent = s2; document.getElementById("status-team2").className = c2; }

    // Update per-player placement tables and bonus squares
    for(let i=0;i<4;i++){
      const bonusSquare = document.getElementById(`bonus-square-${i}`);
      if(bonusSquare){
        const b = players[i].bonus || 0;
        bonusSquare.textContent = b;
        if(b>0) bonusSquare.className = "score-small score-positive";
        else if(b<0) bonusSquare.className = "score-small score-negative";
        else bonusSquare.className = "score-small score-zero-white";
      }
      let placementHtml='';
      for(let h=1;h<=18;h++){
        if(placements[`${h}-${i}`] && placements[`${h}-${i}`].points!==undefined) placementHtml += `Bahn ${h}: ${placements[`${h}-${i}`].points} Punkte<br>`;
      }
      const placementDiv = document.getElementById("placement"+i);
      if(placementDiv) placementDiv.innerHTML = placementHtml;
    }

    // team circles are already updated in computeTeamScoringFromIndividuals
    return;
  }
}

/* KURZSPIEL: render scorecards per player with dropdown selection (0..par*3+1) */
function renderKurzspielScorecards(){
  const container=document.getElementById("playersSection");
  container.innerHTML = ""; // replace with scorecards
  const count = players.length;
  const par = parseInt(document.getElementById("parValue").value) || 2;
  const maxScore = par * 3 + 1;

  for(let i=0;i<count;i++){
    let card = document.createElement("div");
    card.className = "playerCard";
    card.style.minWidth = "300px";
    card.innerHTML = `<div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
      <div><strong>Spieler ${i+1}</strong><br><input type="text" oninput="players[${i}].name=this.value;updateKurzspielTotals();" placeholder="Name (optional)"></div>
      <div id="kurz-total-${i}" class="score-square score-zero-white">0</div>
    </div>
    <div style="margin-top:8px; text-align:center; font-weight:700;">Bahn Ergebnisse</div>
    <div style="margin-top:8px; display:flex; flex-direction:column; gap:8px; width:100%;">
      <div class="hole-row" id="k${i}-holes-1"></div>
      <div class="hole-row" id="k${i}-holes-2"></div>
    </div>
    <div style="margin-top:8px; text-align:center;">
      <button onclick="clearKurzSpielPlayer(${i})">Reset Spieler ${i+1}</button>
    </div>`;

    container.appendChild(card);

    for(let h=1; h<=9; h++){
      const elWrapper = document.createElement('div');
      elWrapper.className = 'kurz-cell';
      const el = document.createElement('div');
      el.className = 'kurz-circle';
      el.id = `k${i}-hole-${h}`;
      el.textContent = '0';
      el.style.minWidth='28px';
      el.style.minHeight='28px';
      elWrapper.appendChild(el);
      // create select
      const sel = document.createElement('select');
      sel.id = `k${i}-sel-${h}`;
      sel.style.fontSize='0.9rem';
      for(let s=0;s<=maxScore;s++){ const opt = document.createElement('option'); opt.value = s; opt.text = s; sel.appendChild(opt); }
      sel.onchange = function(){ kurzScores[i][h] = parseInt(this.value); updateKurzspielCell(i,h); updateKurzspielTotals(); };
      elWrapper.appendChild(sel);
      document.getElementById(`k${i}-holes-1`).appendChild(elWrapper);
    }
    for(let h=10; h<=18; h++){
      const elWrapper = document.createElement('div');
      elWrapper.className = 'kurz-cell';
      const el = document.createElement('div');
      el.className = 'kurz-circle';
      el.id = `k${i}-hole-${h}`;
      el.textContent = '0';
      elWrapper.appendChild(el);
      const sel = document.createElement('select');
      sel.id = `k${i}-sel-${h}`;
      sel.style.fontSize='0.9rem';
      for(let s=0;s<=maxScore;s++){ const opt = document.createElement('option'); opt.value = s; opt.text = s; sel.appendChild(opt); }
      sel.onchange = function(){ kurzScores[i][h] = parseInt(this.value); updateKurzspielCell(i,h); updateKurzspielTotals(); };
      elWrapper.appendChild(sel);
      document.getElementById(`k${i}-holes-2`).appendChild(elWrapper);
    }
  }

  const info = document.createElement('div');
  info.style.width='100%';
  info.style.textAlign='center';
  info.style.marginTop='8px';
  info.innerHTML = `<div style="display:inline-block; background:#fff; padding:8px 10px; border-radius:10px; box-shadow:0 3px 8px rgba(0,0,0,0.06);">
    PAR für alle Bahnen: <strong>${par}</strong>
    <div style="margin-top:6px; font-size:0.9rem; color:#555;">Wähle das Ergebnis per Dropdown (0 bis ${maxScore}). Farben ändern sich automatisch entsprechend PAR.</div>
  </div>`;
  document.getElementById("game").appendChild(info);
}

function updateKurzspielCell(playerIndex, holeNumber){
  const par = parseInt(document.getElementById("parValue").value) || 2;
  const el = document.getElementById(`k${playerIndex}-hole-${holeNumber}`);
  if(!el) return;
  const val = (kurzScores[playerIndex] && kurzScores[playerIndex][holeNumber] !== undefined) ? kurzScores[playerIndex][holeNumber] : 0;
  el.textContent = val;
  const diff = val - par;
  el.className = 'kurz-circle';
  if(val === 0){
    el.style.background = '#fff'; el.style.color='#000'; el.style.borderColor='#000';
  } else {
    el.style.borderColor='transparent';
    if(diff <= -2){ el.classList.add('kurz-orange'); el.style.background='orange'; el.style.color='#fff'; }
    else if(diff === -1){ el.classList.add('kurz-yellow'); el.style.background='yellow'; el.style.color='#000'; }
    else if(diff === 0){ el.classList.add('kurz-blue'); el.style.background='#2b7cff'; el.style.color='#fff'; }
    else if(diff === 1){ el.classList.add('kurz-red'); el.style.background='#d9534f'; el.style.color='#fff'; }
    else if(diff === 2){ el.classList.add('kurz-purple'); el.style.background='purple'; el.style.color='#fff'; }
    else if(diff >= 3){ el.classList.add('kurz-black'); el.style.background='#000'; el.style.color='#fff'; }
    else { el.style.background='#fff'; el.style.color='#000'; }
  }
}

function updateKurzspielTotals(){
  const count = players.length;
  for(let i=0;i<count;i++){
    let total = 0;
    for(let h=1; h<=18; h++){
      if(kurzScores[i] && kurzScores[i][h] !== undefined) total += kurzScores[i][h];
    }
    const totalEl = document.getElementById(`kurz-total-${i}`);
    if(totalEl){
      totalEl.textContent = total;
      if(total>0) totalEl.className = "score-square score-positive";
      else if(total<0) totalEl.className = "score-square score-negative";
      else totalEl.className = "score-square score-neutral";
    }
    for(let h=1; h<=18; h++){
      if(kurzScores[i] && kurzScores[i][h] !== undefined) updateKurzspielCell(i,h);
      else { const el=document.getElementById(`k${i}-hole-${h}`); if(el){ el.textContent='0'; el.className='kurz-circle'; el.style.background='#fff'; el.style.color='#000'; el.style.borderColor='#000'; } }
      const sel = document.getElementById(`k${i}-sel-${h}`);
      if(sel) sel.value = (kurzScores[i] && kurzScores[i][h] !== undefined) ? kurzScores[i][h] : 0;
    }
  }
}

function clearKurzSpielPlayer(i){
  kurzScores[i] = {};
  for(let h=1; h<=18; h++){
    const el = document.getElementById(`k${i}-hole-${h}`);
    if(el){ el.textContent = '0'; el.className='kurz-circle'; el.style.background='#fff'; el.style.color='#000'; el.style.borderColor='#000'; }
    const sel = document.getElementById(`k${i}-sel-${h}`); if(sel) sel.value = 0;
  }
  updateKurzspielTotals();
}

/* Utility: initial setup */
updateModeOptions();
</script>
</body>
</html>
